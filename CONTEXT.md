# Study Preprocessor - í”„ë¡œì íŠ¸ ì»¨í…ìŠ¤íŠ¸

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

**study-preprocessor**ëŠ” ì»¤ë„/ì‹œìŠ¤í…œ ë¡œê·¸ì˜ ì „ì²˜ë¦¬ì™€ ì´ìƒíƒì§€ë¥¼ ìœ„í•œ í†µí•© íŒŒì´í”„ë¼ì¸ì…ë‹ˆë‹¤. LSTM ê¸°ë°˜ DeepLogì™€ ì‹œê³„ì—´ ì´ë¯¸ì§€í™” ê¸°ë°˜ MS-CRED ëª¨ë¸ì— ì…ë ¥ ê°€ëŠ¥í•œ í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ê³ , ë‹¤ì–‘í•œ ì´ìƒíƒì§€ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ¯ í•µì‹¬ ê¸°ëŠ¥

### 1. ë¡œê·¸ ì „ì²˜ë¦¬
- **í…œí”Œë¦¿ ë§ˆì´ë‹**: Drain3 ì•Œê³ ë¦¬ì¦˜ì„ ì‚¬ìš©í•œ ìë™ ë¡œê·¸ í…œí”Œë¦¿ ì¶”ì¶œ
- **ë§ˆìŠ¤í‚¹**: ì •ê·œì‹ ê¸°ë°˜ ë³€ìˆ˜ ê°’ ë§ˆìŠ¤í‚¹ (IP, ê²½ë¡œ, ìˆ«ì ë“±)
- **í¬ë§· ì§€ì›**: syslog, dmesg, ì»¤ë„ ë¡œê·¸ ë“± ë‹¤ì–‘í•œ í¬ë§·

### 2. ì´ìƒíƒì§€ ë°©ë²•
- **ë² ì´ìŠ¤ë¼ì¸ íƒì§€**: ìœˆë„ìš° ê¸°ë°˜ í…œí”Œë¦¿ ë¹ˆë„ ë³€í™” ê°ì§€
- **DeepLog**: LSTM ê¸°ë°˜ ì‹œí€€ìŠ¤ ì˜ˆì¸¡ ëª¨ë¸
- **MS-CRED**: ë©€í‹°ìŠ¤ì¼€ì¼ ì»¨ë³¼ë£¨ì…˜ ì¬êµ¬ì„± ì˜¤ì°¨ ê¸°ë°˜ íƒì§€
- **ì‹œê°„ ê¸°ë°˜ íƒì§€**: ê³¼ê±° ë™ì¼ ì‹œê°„ëŒ€ íŒ¨í„´ê³¼ ë¹„êµ
- **ë¹„êµ íƒì§€**: ì—¬ëŸ¬ íŒŒì¼ ê°„ íŒ¨í„´ ì°¨ì´ ë¶„ì„

### 3. ğŸ†• í•™ìŠµ/ì¶”ë¡  ë¶„ë¦¬ ì›Œí¬í”Œë¡œìš°
- **ëª¨ë¸ í•™ìŠµ**: ì •ìƒ ë¡œê·¸ë¡œ DeepLog, MS-CRED, ë² ì´ìŠ¤ë¼ì¸ í†µê³„ í•™ìŠµ
- **ì´ìƒíƒì§€ ì¶”ë¡ **: í•™ìŠµëœ ëª¨ë¸ë¡œ Target ë¡œê·¸ ë¶„ì„
- **ëª¨ë¸ ë¹„êµ**: ì„œë¡œ ë‹¤ë¥¸ ì‹œì  ëª¨ë¸ë“¤ì˜ ì„±ëŠ¥ ë¹„êµ
- **ì ì§„ì  í•™ìŠµ**: ê¸°ì¡´ ëª¨ë¸ì— ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€ í•™ìŠµ
- **ëª¨ë¸ ê²€ì¦**: ìë™í™”ëœ í’ˆì§ˆ í‰ê°€ (0-100ì )

### 4. ë°°ì¹˜ ë¶„ì„
- **ë‹¨ì¼ íŒŒì¼**: ê°œë³„ ë¡œê·¸ íŒŒì¼ ì „ì²˜ë¦¬
- **ë””ë ‰í† ë¦¬ ë°°ì¹˜**: í´ë” ë‚´ ëª¨ë“  ë¡œê·¸ íŒŒì¼ ì¼ê´„ ì²˜ë¦¬
- **ì¬ê·€ ìŠ¤ìº”**: í•˜ìœ„ ë””ë ‰í† ë¦¬ í¬í•¨ ì „ì²´ ìŠ¤ìº”
- **ë‚ ì§œë³„ êµ¬ì¡°**: ë‚ ì§œ/ì¹´í…Œê³ ë¦¬ë³„ í´ë” êµ¬ì¡° ì§€ì›

## ğŸ—‚ï¸ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
study_preprocessor/
â”œâ”€â”€ study_preprocessor/          # í•µì‹¬ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ cli.py                  # CLI ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ preprocess.py           # ì „ì²˜ë¦¬ (ë§ˆìŠ¤í‚¹ + Drain3)
â”‚   â”œâ”€â”€ detect.py               # ë² ì´ìŠ¤ë¼ì¸ ì´ìƒíƒì§€
â”‚   â”œâ”€â”€ synth.py                # í•©ì„± ë°ì´í„° ìƒì„±
â”‚   â”œâ”€â”€ eval.py                 # í‰ê°€ ë©”íŠ¸ë¦­
â”‚   â””â”€â”€ builders/               # ëª¨ë¸ë³„ ì…ë ¥ ë¹Œë”
â”‚       â”œâ”€â”€ deeplog.py          # DeepLogìš© ì‹œí€€ìŠ¤ ìƒì„±
â”‚       â””â”€â”€ mscred.py           # MS-CREDìš© ìœˆë„ìš° ì¹´ìš´íŠ¸
â”œâ”€â”€ data/                       # ë°ì´í„° ë””ë ‰í† ë¦¬
â”‚   â”œâ”€â”€ raw/                    # ì›ì‹œ ë¡œê·¸ íŒŒì¼
â”‚   â””â”€â”€ processed/              # ì „ì²˜ë¦¬ ê²°ê³¼
â”œâ”€â”€ enhanced_batch_analyzer.py   # í–¥ìƒëœ ë°°ì¹˜ ë¶„ì„ê¸°
â”œâ”€â”€ temporal_anomaly_detector.py # ì‹œê°„ ê¸°ë°˜ ì´ìƒíƒì§€
â”œâ”€â”€ comparative_anomaly_detector.py # ë¹„êµ ê¸°ë°˜ ì´ìƒíƒì§€
â”œâ”€â”€ log_sample_analyzer.py      # ì´ìƒ ë¡œê·¸ ìƒ˜í”Œ ì¶”ì¶œ ë° ë¶„ì„
â”œâ”€â”€ rules.json                  # ë§ˆìŠ¤í‚¹ ê·œì¹™ ì„¤ì •
â”œâ”€â”€ train_models.sh             # ğŸ†• ëª¨ë¸ í•™ìŠµ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ run_inference.sh            # ğŸ†• ì´ìƒíƒì§€ ì¶”ë¡  ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ compare_models.sh           # ğŸ†• ëª¨ë¸ ë¹„êµ ë„êµ¬
â”œâ”€â”€ train_models_incremental.sh # ğŸ†• ì ì§„ì  í•™ìŠµ ë„êµ¬
â”œâ”€â”€ validate_models.sh          # ğŸ†• ëª¨ë¸ ê²€ì¦ ë„êµ¬
â””â”€â”€ run_*.sh                    # ê¸°íƒ€ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ë“¤
```

## ğŸ”§ ì£¼ìš” êµ¬ì„± ìš”ì†Œ

### ë§ˆìŠ¤í‚¹ ê·œì¹™ (rules.json)
```json
{
  "hex_addresses": "0x[0-9a-fA-F]+ â†’ <HEX>",
  "ipv4_addresses": "192.168.1.1 â†’ <IP>",
  "file_paths": "/usr/bin/python â†’ <PATH>",
  "device_numbers": "eth0 â†’ eth<ID>",
  "decimal_numbers": "123 â†’ <NUM>"
}
```

### CLI ëª…ë ¹ì–´
```bash
# ê¸°ë³¸ ì „ì²˜ë¦¬
study-preprocess parse --input file.log --out-dir processed/

# DeepLog ì…ë ¥ ìƒì„±
study-preprocess build-deeplog --parsed parsed.parquet --out-dir processed/

# ì´ìƒíƒì§€ ì‹¤í–‰
study-preprocess detect --parsed parsed.parquet --out-dir processed/

# ë°°ì¹˜ ë¶„ì„
./run_enhanced_batch_analysis.sh /var/log/
```

## ğŸ“Š ì‚°ì¶œë¬¼ í˜•ì‹

### ì „ì²˜ë¦¬ ê²°ê³¼
- **parsed.parquet**: ì£¼ìš” ì „ì²˜ë¦¬ í…Œì´ë¸”
  - `line_no`: ë¼ì¸ ë²ˆí˜¸
  - `timestamp`: íŒŒì‹±ëœ íƒ€ì„ìŠ¤íƒ¬í”„
  - `host`: í˜¸ìŠ¤íŠ¸ëª… (syslog)
  - `process`: í”„ë¡œì„¸ìŠ¤ëª…
  - `raw`: ì›ë³¸ ë©”ì‹œì§€
  - `masked`: ë§ˆìŠ¤í‚¹ëœ ë©”ì‹œì§€
  - `template_id`: Drain3 í…œí”Œë¦¿ ID
  - `template`: ì¶”ì¶œëœ í…œí”Œë¦¿

### DeepLog ì…ë ¥
- **vocab.json**: í…œí”Œë¦¿ ID â†’ ì¸ë±ìŠ¤ ë§¤í•‘
- **sequences.parquet**: ì •ë ¬ëœ í…œí”Œë¦¿ ì¸ë±ìŠ¤ ì‹œí€€ìŠ¤

### ì´ìƒíƒì§€ ê²°ê³¼
- **baseline_scores.parquet**: ìœˆë„ìš°ë³„ ì´ìƒ ì ìˆ˜
- **deeplog_infer.parquet**: DeepLog ì˜ˆì¸¡ ê²°ê³¼
- **report.md**: ìƒìœ„ ì´ìƒ ìœˆë„ìš° ìš”ì•½

## ğŸš€ ì›Œí¬í”Œë¡œìš°

### 1. ë‹¨ì¼ íŒŒì¼ ë¶„ì„
```bash
# 1. ì „ì²˜ë¦¬
study-preprocess parse --input /path/to/app.log --out-dir data/processed

# 2. ëª¨ë¸ ì…ë ¥ ìƒì„±
study-preprocess build-deeplog --parsed data/processed/parsed.parquet --out-dir data/processed

# 3. ì´ìƒíƒì§€
study-preprocess detect --parsed data/processed/parsed.parquet --out-dir data/processed

# 4. ë¦¬í¬íŠ¸ ìƒì„±
study-preprocess report --processed-dir data/processed
```

### 2. ğŸ†• í•™ìŠµ/ì¶”ë¡  ë¶„ë¦¬ ì›Œí¬í”Œë¡œìš° (ì¶”ì²œ)
```bash
# 1ë‹¨ê³„: ì •ìƒ ë¡œê·¸ë¡œ ëª¨ë¸ í•™ìŠµ
./train_models.sh /var/log/normal/ my_models

# 2ë‹¨ê³„: ëª¨ë¸ í’ˆì§ˆ ê²€ì¦
./validate_models.sh my_models

# 3ë‹¨ê³„: Target ë¡œê·¸ ì´ìƒíƒì§€ (ì‹¤ì œ ë¡œê·¸ ìƒ˜í”Œ í¬í•¨)
./run_inference.sh my_models /var/log/suspicious.log

# ê²°ê³¼ í™•ì¸
cat inference_*/log_samples_analysis/anomaly_analysis_report.md
```

### 3. ë°°ì¹˜ ë¶„ì„
```bash
# í–¥ìƒëœ ë°°ì¹˜ ë¶„ì„
./run_enhanced_batch_analysis.sh /var/log/ app.log 3 20 batch_result

# ê²°ê³¼ í™•ì¸
cat batch_result/ENHANCED_ANALYSIS_SUMMARY.md
```

### 4. ì‹œê°„ ê¸°ë°˜ ë¶„ì„
```bash
# ì‹œê°„ëŒ€ë³„ íŒ¨í„´ í•™ìŠµ ë° ì´ìƒíƒì§€
study-preprocess analyze-temporal --data-dir data/processed
cat data/processed/temporal_analysis/temporal_report.md
```

## ğŸ” ì´ìƒíƒì§€ ë°©ë²•ë¡ 

### ë² ì´ìŠ¤ë¼ì¸ ë°©ë²•
- **ìœˆë„ìš° ê¸°ë°˜**: 50ê°œ ë¼ì¸ì„ í•˜ë‚˜ì˜ ìœˆë„ìš°ë¡œ ì²˜ë¦¬
- **ë¹ˆë„ ë¶„ì„**: í…œí”Œë¦¿ ì¶œí˜„ ë¹ˆë„ì˜ ê¸‰ê²©í•œ ë³€í™” ê°ì§€
- **ë¯¸ì§€ í…œí”Œë¦¿**: ìƒˆë¡œìš´ í…œí”Œë¦¿ì˜ ë¹„ìœ¨ ëª¨ë‹ˆí„°ë§
- **EWM í†µê³„**: ì§€ìˆ˜ ê°€ì¤‘ ì´ë™ í‰ê· ìœ¼ë¡œ ì •ìƒ íŒ¨í„´ í•™ìŠµ

### DeepLog ë°©ë²•
- **LSTM ëª¨ë¸**: ì‹œí€€ìŠ¤ íŒ¨í„´ í•™ìŠµ
- **Top-K ì˜ˆì¸¡**: ë‹¤ìŒ í…œí”Œë¦¿ ìƒìœ„ Kê°œ ì˜ˆì¸¡
- **ìœ„ë°˜ íƒì§€**: ì˜ˆì¸¡ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ëŠ” íŒ¨í„´ ê°ì§€

### ì‹œê°„ ê¸°ë°˜ ë°©ë²•
- **ì‹œê°„ëŒ€ë³„ í”„ë¡œíŒŒì¼**: ì‹œê°„/ìš”ì¼ë³„ ì •ìƒ íŒ¨í„´ í•™ìŠµ
- **ê³„ì ˆì„± ê³ ë ¤**: ì£¼ê¸°ì  íŒ¨í„´ ë°˜ì˜
- **ì´ìƒ ì„ê³„ê°’**: ê³¼ê±° ë™ì¼ ì‹œê°„ëŒ€ ëŒ€ë¹„ í¸ì°¨ ê³„ì‚°

### ë¹„êµ ê¸°ë°˜ ë°©ë²•
- **íŒŒì¼ ê°„ ë¹„êµ**: ì—¬ëŸ¬ ì‹œìŠ¤í…œ/ì„œë¹„ìŠ¤ ë¡œê·¸ ë¹„êµ
- **ìœ ì‚¬ë„ ì¸¡ì •**: ì½”ì‚¬ì¸ ìœ ì‚¬ë„, KL divergence ë“±
- **ìƒëŒ€ì  ì´ìƒ**: ë‹¤ë¥¸ íŒŒì¼ ëŒ€ë¹„ íŠ¹ì´í•œ íŒ¨í„´ ê°ì§€

## âš™ï¸ ì„¤ì • íŒŒë¼ë¯¸í„°

### Drain3 ì„¤ì •
- **depth**: 4 (íŒŒì‹± íŠ¸ë¦¬ ê¹Šì´)
- **similarity_threshold**: 0.4 (í…œí”Œë¦¿ ìœ ì‚¬ë„ ì„ê³„ê°’)
- **max_clusters**: 1000 (ìµœëŒ€ í…œí”Œë¦¿ ìˆ˜)

### ì´ìƒíƒì§€ ì„¤ì •
- **window_size**: 50 (ìœˆë„ìš° í¬ê¸°)
- **stride**: 25 (ìŠ¬ë¼ì´ë”© ìŠ¤íŠ¸ë¼ì´ë“œ)
- **ewm_alpha**: 0.3 (ì§€ìˆ˜ ê°€ì¤‘ í‰ê·  ê³„ìˆ˜)
- **anomaly_quantile**: 0.95 (ì´ìƒ ì„ê³„ê°’ ë¶„ìœ„ìˆ˜)

### ë°°ì¹˜ ë¶„ì„ ì„¤ì •
- **max_depth**: 3 (í•˜ìœ„ ë””ë ‰í† ë¦¬ ìŠ¤ìº” ê¹Šì´)
- **max_files**: 20 (ìµœëŒ€ ì²˜ë¦¬ íŒŒì¼ ìˆ˜)
- **log_patterns**: *.log, *.txt, *.syslog ë“±

## ğŸ”¬ ê³ ê¸‰ ê¸°ëŠ¥

### ğŸ†• ëª¨ë¸ ê´€ë¦¬ ë„êµ¬

#### ëª¨ë¸ ë¹„êµ
```bash
# ë‘ ëª¨ë¸ì˜ ì„±ëŠ¥ ë¹„êµ
./compare_models.sh old_models new_models /var/log/test.log
```

#### ì ì§„ì  í•™ìŠµ
```bash
# ê¸°ì¡´ ëª¨ë¸ì— ìƒˆë¡œìš´ ë°ì´í„° ì¶”ê°€ í•™ìŠµ
./train_models_incremental.sh base_models /var/log/new_normal/ updated_models
```

#### ëª¨ë¸ ê²€ì¦
```bash
# ëª¨ë¸ í’ˆì§ˆ ìë™ í‰ê°€ (0-100ì )
./validate_models.sh my_models
```

### ì´ìƒ ë¡œê·¸ ìƒ˜í”Œ ë¶„ì„
```bash
# ì´ìƒíƒì§€ ê²°ê³¼ì—ì„œ ì‹¤ì œ ë¬¸ì œ ë¡œê·¸ë“¤ ì¶”ì¶œ
study-preprocess analyze-samples --processed-dir data/processed --output-dir log_samples
```

### í•©ì„± ë°ì´í„° ìƒì„±
```bash
# í…ŒìŠ¤íŠ¸ìš© í•©ì„± ë¡œê·¸ ìƒì„±
study-preprocess gen-synth --out data/raw/synthetic.log --lines 10000 --anomaly-rate 0.03
```

### í‰ê°€ ë©”íŠ¸ë¦­
```bash
# Precision, Recall, F1 ê³„ì‚°
study-preprocess eval --processed-dir data/processed --labels data/raw/synthetic.log.labels.parquet
```

### ì‹œê°í™”
```bash
# ê²°ê³¼ ì‹œê°í™” (ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸)
python visualize_results.py --data-dir data/processed
```

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

### ì²˜ë¦¬ ì„±ëŠ¥
- **ëª©í‘œ**: 1GB ë¡œê·¸ < 2ë¶„ (M1/M2 ê¸°ì¤€)
- **ë©”ëª¨ë¦¬**: ì²­í¬ ë‹¨ìœ„ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
- **ì €ì¥**: Parquet í˜•ì‹ìœ¼ë¡œ íš¨ìœ¨ì  ì••ì¶•

### íƒì§€ ì„±ëŠ¥
- **ë² ì´ìŠ¤ë¼ì¸**: F1 Score 0.7-0.8 (í•©ì„± ë°ì´í„°)
- **DeepLog**: Violation Rate 0.05-0.15 (ì •ìƒ ë¡œê·¸)
- **ì‹¤ì‹œê°„**: ìœˆë„ìš° ë‹¨ìœ„ ì¦‰ì‹œ íƒì§€ ê°€ëŠ¥

## ğŸ› ï¸ ê°œë°œ í™˜ê²½

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­
- Python 3.11+
- pip ë˜ëŠ” uv íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €

### ì£¼ìš” ì˜ì¡´ì„±
- **drain3**: í…œí”Œë¦¿ ë§ˆì´ë‹
- **pandas**: ë°ì´í„° ì²˜ë¦¬
- **pyarrow**: Parquet I/O
- **torch**: DeepLog ëª¨ë¸
- **click**: CLI ì¸í„°í˜ì´ìŠ¤

### ì„¤ì¹˜ ë°©ë²•
```bash
# ê°€ìƒí™˜ê²½ ìƒì„±
python -m venv .venv
source .venv/bin/activate

# íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -e .
```

## ğŸ”„ í™•ì¥ ê³„íš

### ë‹¨ê¸° ê³„íš
- [ ] ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
- [ ] ì›¹ ëŒ€ì‹œë³´ë“œ ì¸í„°í˜ì´ìŠ¤
- [ ] ì¶”ê°€ ë¡œê·¸ í¬ë§· ì§€ì›

### ì¥ê¸° ê³„íš
- [ ] ë¶„ì‚° ì²˜ë¦¬ (Spark ì—°ë™)
- [ ] ê¸°ê³„í•™ìŠµ ëª¨ë¸ ì¶”ê°€
- [ ] í´ë¼ìš°ë“œ ì—°ë™

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- [PRD.md](./prd.md): ì œí’ˆ ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ
- [README.md](./README.md): ì‚¬ìš©ì ê°€ì´ë“œ
- [BATCH_ANALYSIS_GUIDE.md](./BATCH_ANALYSIS_GUIDE.md): ë°°ì¹˜ ë¶„ì„ ê°€ì´ë“œ
- [ANOMALY_DETECTION_METHODS.md](./ANOMALY_DETECTION_METHODS.md): ì´ìƒíƒì§€ ë°©ë²•ë¡ 
- [RESULTS_GUIDE.md](./RESULTS_GUIDE.md): ê²°ê³¼ í•´ì„ ê°€ì´ë“œ
