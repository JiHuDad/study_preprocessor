# ë¡œê·¸ ì´ìƒ íƒì§€ ê²°ê³¼ í•´ì„ ê°€ì´ë“œ

## ğŸ¯ ê°œìš”

ì´ ë¬¸ì„œëŠ” log anomaly detection pipelineì˜ ê²°ê³¼ë¥¼ í•´ì„í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“ ê²°ê³¼ íŒŒì¼ êµ¬ì¡°

```
data/processed/  (ë˜ëŠ” ë‹¤ë¥¸ ë°ì´í„°ì…‹ ë””ë ‰í† ë¦¬)
â”œâ”€â”€ parsed.parquet          # íŒŒì‹±ëœ ì›ë³¸ ë¡œê·¸ ë°ì´í„°
â”œâ”€â”€ sequences.parquet       # í…œí”Œë¦¿ ì‹œí€€ìŠ¤ ë°ì´í„°
â”œâ”€â”€ vocab.json             # í…œí”Œë¦¿ ID â†’ ì¸ë±ìŠ¤ ë§¤í•‘
â”œâ”€â”€ preview.json           # ë¡œê·¸ ìƒ˜í”Œ ë¯¸ë¦¬ë³´ê¸°
â”œâ”€â”€ baseline_scores.parquet # Baseline ì´ìƒ íƒì§€ ê²°ê³¼
â”œâ”€â”€ deeplog_infer.parquet  # DeepLog ë”¥ëŸ¬ë‹ ëª¨ë¸ ê²°ê³¼
â””â”€â”€ report.md              # ìë™ ìƒì„±ëœ ìš”ì•½ ë¦¬í¬íŠ¸
```

## ğŸ” ì£¼ìš” ê²°ê³¼ í•´ì„

### 1. Baseline Anomaly Detection

**íŒŒì¼**: `baseline_scores.parquet`

| ì»¬ëŸ¼ | ì„¤ëª… |
|------|------|
| `window_start_line` | ìœˆë„ìš° ì‹œì‘ ë¼ì¸ ë²ˆí˜¸ |
| `unseen_rate` | ìœˆë„ìš° ë‚´ ë¯¸ì§€ í…œí”Œë¦¿ ë¹„ìœ¨ (0.0-1.0) |
| `score` | ì´ìƒ ì ìˆ˜ (ë†’ì„ìˆ˜ë¡ ì´ìƒ) |
| `is_anomaly` | ì´ìƒ ì—¬ë¶€ (True/False) |

**í•´ì„**:
- `unseen_rate`ê°€ ë†’ìœ¼ë©´ â†’ ìƒˆë¡œìš´/ë“œë¬¸ ë¡œê·¸ íŒ¨í„´ ë°œê²¬
- `score`ê°€ ë†’ìœ¼ë©´ â†’ ì´ìƒ ê°€ëŠ¥ì„± ë†’ìŒ
- `is_anomaly=True` â†’ ì‹¤ì œ ì´ìƒìœ¼ë¡œ íŒì •ëœ ìœˆë„ìš°

### 2. DeepLog ë”¥ëŸ¬ë‹ ëª¨ë¸

**íŒŒì¼**: `deeplog_infer.parquet`

| ì»¬ëŸ¼ | ì„¤ëª… |
|------|------|
| `idx` | ì‹œí€€ìŠ¤ ì¸ë±ìŠ¤ |
| `target` | ì˜ˆìƒë˜ëŠ” ë‹¤ìŒ í…œí”Œë¦¿ ID |
| `in_topk` | ì˜ˆìƒì´ top-k ë‚´ì— ìˆëŠ”ì§€ ì—¬ë¶€ |

**í•´ì„**:
- `in_topk=False` â†’ ì˜ˆì¸¡ ì‹¤íŒ¨ (ì´ìƒ ê°€ëŠ¥ì„±)
- ìœ„ë°˜ìœ¨ì´ ë†’ìœ¼ë©´ â†’ ë¡œê·¸ íŒ¨í„´ì´ ì˜ˆì¸¡í•˜ê¸° ì–´ë ¤ì›€

## ğŸ“Š ì„±ëŠ¥ ì§€í‘œ

### ì´ìƒë¥  (Anomaly Rate)
- **ë‚®ìŒ (<5%)**: ì •ìƒì ì¸ ì‹œìŠ¤í…œ
- **ì¤‘ê°„ (5-20%)**: ì¼ë¶€ ë¹„ì •ìƒ íŒ¨í„´ ì¡´ì¬
- **ë†’ìŒ (>20%)**: ì‹œìŠ¤í…œì— ë¬¸ì œ ê°€ëŠ¥ì„±

### DeepLog ìœ„ë°˜ìœ¨ (Violation Rate)
- **ë‚®ìŒ (<20%)**: ì˜ˆì¸¡ ê°€ëŠ¥í•œ ë¡œê·¸ íŒ¨í„´
- **ì¤‘ê°„ (20-50%)**: ì¼ë¶€ ì˜ˆì¸¡ ì–´ë ¤ìš´ íŒ¨í„´
- **ë†’ìŒ (>50%)**: ë§¤ìš° ë³µì¡í•œ/ë¹„ì •ìƒì ì¸ íŒ¨í„´

## ğŸ› ï¸ ê²°ê³¼ í™•ì¸ ë°©ë²•

### 1. ìë™ ë¶„ì„ ë„êµ¬ ì‚¬ìš©
```bash
# ê¸°ë³¸ ë°ì´í„°ì…‹ ë¶„ì„
python analyze_results.py

# íŠ¹ì • ë°ì´í„°ì…‹ ë¶„ì„
python analyze_results.py --data-dir data/test_synthetic
```

### 2. ìˆ˜ë™ ë°ì´í„° í™•ì¸
```python
import pandas as pd

# Baseline ê²°ê³¼ í™•ì¸
baseline = pd.read_parquet('data/processed/baseline_scores.parquet')
print(baseline[baseline['is_anomaly'] == True])

# DeepLog ê²°ê³¼ í™•ì¸
deeplog = pd.read_parquet('data/processed/deeplog_infer.parquet')
violations = deeplog[deeplog['in_topk'] == False]
print(f"ìœ„ë°˜ìœ¨: {len(violations)/len(deeplog)*100:.1f}%")
```

## ğŸš¨ ì´ìƒ íƒì§€ ê²°ê³¼ ì´í•´í•˜ê¸°

### Case 1: ì •ìƒ ì‹œìŠ¤í…œ
- Baseline ì´ìƒë¥ : <5%
- DeepLog ìœ„ë°˜ìœ¨: <20%
- â†’ ì‹œìŠ¤í…œì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™

### Case 2: ì¼ë¶€ ë¹„ì •ìƒ
- Baseline ì´ìƒë¥ : 5-20%
- DeepLog ìœ„ë°˜ìœ¨: 20-50%
- â†’ ì¡°ì‚¬ê°€ í•„ìš”í•œ ì¼ë¶€ íŒ¨í„´ ì¡´ì¬

### Case 3: ë¬¸ì œ ìƒí™©
- Baseline ì´ìƒë¥ : >20%
- DeepLog ìœ„ë°˜ìœ¨: >50%
- â†’ ì‹œìŠ¤í…œì— ì‹¬ê°í•œ ë¬¸ì œ ê°€ëŠ¥ì„±

## ğŸ“ˆ ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ ê²°ê³¼ í•´ì„:
```
ğŸš¨ Baseline Anomaly Detection ê²°ê³¼
- ë°œê²¬ëœ ì´ìƒ ìœˆë„ìš°: 1ê°œ (ì „ì²´ì˜ 25.0%)
- ìœˆë„ìš° ì‹œì‘ë¼ì¸ 0: ì ìˆ˜=0.400, ë¯¸ì§€í…œí”Œë¦¿ë¹„ìœ¨=1.000

ğŸ§  DeepLog ë”¥ëŸ¬ë‹ ëª¨ë¸ ê²°ê³¼  
- ìœ„ë°˜ìœ¨: 50.0%
```

**í•´ì„**: 
- 25%ì˜ ë†’ì€ ì´ìƒë¥  â†’ ì‹œìŠ¤í…œì— ë¹„ì •ìƒì ì¸ íŒ¨í„´
- 100% ë¯¸ì§€ í…œí”Œë¦¿ â†’ ì™„ì „íˆ ìƒˆë¡œìš´ ë¡œê·¸ íŒ¨í„´ ë°œê²¬
- 50% DeepLog ìœ„ë°˜ìœ¨ â†’ ì˜ˆì¸¡í•˜ê¸° ì–´ë ¤ìš´ ë³µì¡í•œ íŒ¨í„´

## ğŸ’¡ íŒ

1. **ì •ê¸°ì  ëª¨ë‹ˆí„°ë§**: ìœ„ë°˜ìœ¨/ì´ìƒë¥ ì˜ ì‹œê°„ë³„ ë³€í™” ì¶”ì 
2. **ì„ê³„ê°’ ì¡°ì •**: í™˜ê²½ì— ë§ê²Œ ì´ìƒ íƒì§€ ì„ê³„ê°’ ì¡°ì •
3. **íŒ¨í„´ ë¶„ì„**: ì´ìƒìœ¼ë¡œ íŒì •ëœ ì‹¤ì œ ë¡œê·¸ ë‚´ìš© ê²€í† 
4. **False Positive ê´€ë¦¬**: ì •ìƒì´ì§€ë§Œ ì´ìƒìœ¼ë¡œ íŒì •ëœ ì¼€ì´ìŠ¤ ë¶„ì„

## ğŸ”§ ì¶”ê°€ ë¶„ì„ ë„êµ¬

### ê¸°ë³¸ ë¶„ì„ ë„êµ¬
```bash
# ìƒì„¸ ë¶„ì„
python analyze_results.py --data-dir ì¶œë ¥ë””ë ‰í† ë¦¬

# ì‹œê°í™” ë° ìš”ì•½
python visualize_results.py --data-dir ì¶œë ¥ë””ë ‰í† ë¦¬
```

### ğŸ• ì‹œê°„ ê¸°ë°˜ ì´ìƒ íƒì§€
ê³¼ê±° ë™ì¼ ì‹œê°„ëŒ€/ìš”ì¼ì˜ íŒ¨í„´ê³¼ ë¹„êµí•˜ì—¬ ì´ìƒì„ íƒì§€í•©ë‹ˆë‹¤.

```bash
# ì‹œê°„ íŒ¨í„´ ê¸°ë°˜ ë¶„ì„
python temporal_anomaly_detector.py --data-dir data/processed

# ê²°ê³¼ í™•ì¸
cat data/processed/temporal_analysis/temporal_report.md
```

**ë¶„ì„ ë‚´ìš©**:
- ì‹œê°„ëŒ€ë³„ ì •ìƒ í”„ë¡œíŒŒì¼ í•™ìŠµ (0-23ì‹œ)
- ìš”ì¼ë³„ íŒ¨í„´ ë¶„ì„
- ë³¼ë¥¨ ì´ìƒ ê°ì§€ (ì˜ˆìƒ ëŒ€ë¹„ 50% ì´ìƒ ì°¨ì´)
- ìƒˆë¡œìš´/ëˆ„ë½ëœ í…œí”Œë¦¿ íƒì§€

### ğŸ“Š íŒŒì¼ë³„ ë¹„êµ ì´ìƒ íƒì§€  
ì—¬ëŸ¬ ë¡œê·¸ íŒŒì¼ ê°„ì˜ íŒ¨í„´ ì°¨ì´ë¥¼ ë¶„ì„í•˜ì—¬ ì´ìƒì„ íƒì§€í•©ë‹ˆë‹¤.

```bash
# íŒŒì¼ ê°„ ë¹„êµ ë¶„ì„
python comparative_anomaly_detector.py \
  --target data/server1/parsed.parquet \
  --baselines data/server2/parsed.parquet data/server3/parsed.parquet

# ê²°ê³¼ í™•ì¸
cat data/server1/comparative_analysis/comparative_report.md
```

**ë¶„ì„ ë‚´ìš©**:
- ë¡œê·¸ ë³¼ë¥¨, í…œí”Œë¦¿ ìˆ˜, ì—ëŸ¬ìœ¨ ë¹„êµ
- í…œí”Œë¦¿ ë¶„í¬ KL Divergence ê³„ì‚°
- ê³ ìœ /ëˆ„ë½ í…œí”Œë¦¿ ë¶„ì„
- Z-score ê¸°ë°˜ ì´ìƒì¹˜ íƒì§€

### CLI ë„êµ¬
```bash
# ê¸°ë³¸ CLI ë„êµ¬
.venv/bin/python -m study_preprocessor.cli detect --help
.venv/bin/python -m study_preprocessor.cli eval --help
```
